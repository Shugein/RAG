# RAG News Processing System

ะกะธััะตะผะฐ ะดะปั ะฟัะธะตะผะฐ, ะพะฑัะฐะฑะพัะบะธ ะธ ะธะฝะดะตะบัะฐัะธะธ ัะธะฝะฐะฝัะพะฒัั ะฝะพะฒะพััะตะน ั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ะธะทะฒะปะตัะตะฝะธะตะผ ัััะฝะพััะตะน, ะณะธะฑัะธะดะฝัะผ ะฟะพะธัะบะพะผ ะธ ะณะตะฝะตัะฐัะธะตะน ััะฐัะตะน ัะตัะตะท LLM.

## ๐๏ธ ะััะธัะตะบัััะฐ

```
ะะฝะตัะฝะธะต API โ HTTP Server โ Queue โ Processing Pipeline โ Weaviate Vector DB โ Search โ Article Generation
                (8081)                (NER + Chunking)        (8080)           (Hybrid)      (LLM)
```

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
RAG/
โโโ src/
โ   โโโ download/                    # ะะพะดัะปะธ ะทะฐะณััะทะบะธ ะธ ะฟัะธะตะผะฐ ะดะฐะฝะฝัั
โ   โ   โโโ downloader_functions.py # ะะฐะณััะทะบะฐ ะธ ะฟะพะดะณะพัะพะฒะบะฐ ะดะฐะฝะฝัั (ั NER)
โ   โ   โโโ check_collection.py     # ะัะพะฒะตัะบะฐ ะบะพะปะปะตะบัะธะน Weaviate
โ   โ
โ   โโโ system/                      # ะฏะดัะพ ัะธััะตะผั
โ   โ   โโโ vdb.py                  # ะกะพะทะดะฐะฝะธะต ะฒะตะบัะพัะฝะพะน ะะ ะธ ะทะฐะณััะทะบะฐ ะดะฐะฝะฝัั
โ   โ   โโโ entity_recognition.py   # ะะทะฒะปะตัะตะฝะธะต ัะธะฝะฐะฝัะพะฒัั ัััะฝะพััะตะน (GPT-4o-mini)
โ   โ   โโโ search.py               # ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ ั ัะตัะฐะฝะบะธะฝะณะพะผ
โ   โ   โโโ engine.py               # RAG ะฟะฐะนะฟะปะฐะนะฝ (ะฟะพะธัะบ + ะณะตะฝะตัะฐัะธั)
โ   โ   โ
โ   โ   โโโ LLM_final/              # ะะตะฝะตัะฐัะธั ััะฐัะตะน
โ   โ       โโโ main.py             # ะัะฝะพะฒะฝะพะน ะผะพะดัะปั ะณะตะฝะตัะฐัะธะธ
โ   โ       โโโ sys_prompt.py       # System prompt ะดะปั LLM
โ   โ       โโโ output.py           # ะะตะฝะดะตัะธะฝะณ ะฒ HTML/PDF
โ   โ
โโโ parser/                         # ะะธัะตะบัะพัะธั ั ะดะฐะฝะฝัะผะธ
โ   โโโ test_news.json             # ะขะตััะพะฒัะต ะฝะพะฒะพััะธ (10 ัััะบ)
โ
โโโ docker-compose.yml             # Docker ะบะพะฝัะธะณััะฐัะธั
โโโ requirements.txt               # Python ะทะฐะฒะธัะธะผะพััะธ
โโโ .env                          # API ะบะปััะธ (ะฝะต ะฒ git)
```

## ๐ ะัััััะน ััะฐัั

### 1. ะขัะตะฑะพะฒะฐะฝะธั

- **Python**: 3.10+
- **Docker**: 20.10+ ั Docker Compose
- **GPU**: NVIDIA GPU ั CUDA (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะดะปั ะฒะตะบัะพัะธะทะฐัะธะธ)
- **RAM**: ะผะธะฝะธะผัะผ 8GB
- **API ะบะปััะธ**: OpenAI API (ะดะปั ะธะทะฒะปะตัะตะฝะธั ัััะฝะพััะตะน ะธ ะณะตะฝะตัะฐัะธะธ ััะฐัะตะน)

### 2. ะฃััะฐะฝะพะฒะบะฐ

```bash
# ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน
git clone <repository-url>
cd RAG

# ะกะพะทะดะฐัั ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# ะธะปะธ
venv\Scripts\activate  # Windows

# ะฃััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ
pip install -r requirements.txt
```

### 3. ะะฐัััะพะนะบะฐ API ะบะปััะตะน

ะกะพะทะดะฐะนัะต ัะฐะนะป `.env` ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ:

```bash
# OpenAI API ะบะปัั (ะดะปั GPT-4o-mini ะฒ entity_recognition)
API_KEY_2=sk-your-openai-api-key

# OpenAI API ะบะปัั (ะดะปั GPT-5 ะฒ ะณะตะฝะตัะฐัะธะธ ััะฐัะตะน)
API_KEY=sk-your-openai-api-key

# ะะพะดะตะปั ะดะปั ะณะตะฝะตัะฐัะธะธ ััะฐัะตะน (ะพะฟัะธะพะฝะฐะปัะฝะพ)
OPENAI_MODEL=gpt-5
```

### 4. ะะฐะฟััะบ Weaviate

```bash
# ะะฐะฟัััะธัั ะฒัะต ัะตัะฒะธัั (Weaviate + ะฒะตะบัะพัะธะทะฐัะพั + reranker)
docker compose up -d

# ะัะพะฒะตัะธัั ััะฐััั
docker ps

# ะะพะปะถะฝะพ ะฑััั ะทะฐะฟััะตะฝะพ:
# - weaviate (ะฟะพัั 8080)
# - text2vec-transformers (ะฟะพัั 8083) - ะฒะตะบัะพัะธะทะฐัะพั ะฝะฐ GPU
# - bge-reranker (ะฟะพัั 8082) - reranker
```

ะะพะดะพะถะดะธัะต ~1-2 ะผะธะฝััั ะฟะพะบะฐ ะฒัะต ัะตัะฒะธัั ะฟัะพะณััะทัััั.

### 5. ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั ะฒ ะะ

```bash
# ะกะพะทะดะฐัั ะบะพะปะปะตะบัะธั ะธ ะทะฐะณััะทะธัั ัะตััะพะฒัะต ะดะฐะฝะฝัะต (10 ะฝะพะฒะพััะตะน)
python src/system/vdb.py
```

**ะงัะพ ะฟัะพะธััะพะดะธั:**
1. ะะฐะณััะถะฐัััั ะฝะพะฒะพััะธ ะธะท `parser/test_news.json`
2. ะะปั ะบะฐะถะดะพะน ะฝะพะฒะพััะธ ะธะทะฒะปะตะบะฐัััั ัััะฝะพััะธ (ะบะพะผะฟะฐะฝะธะธ, ะฟะตััะพะฝั, ััะฝะบะธ, ะผะตััะธะบะธ) ัะตัะตะท GPT-4o-mini
3. ะขะตะบััั ัะฐะฝะบััััั ะธ ะปะตะผะผะฐัะธะทะธัััััั
4. ะะฐะฝะฝัะต ะธะฝะดะตะบัะธัััััั ะฒ Weaviate ั ะฐะฒัะพะผะฐัะธัะตัะบะพะน GPU-ะฒะตะบัะพัะธะทะฐัะธะตะน

**ะัะฒะพะด:**
```
ะะฝะธัะธะฐะปะธะทะธัะพะฒะฐะฝ ัะบัััะฐะบัะพั ัััะฝะพััะตะน: gpt-4o-mini
ะะทะฒะปะตัะตะฝะธะต ัััะฝะพััะตะน ะฟะฐัะฐะปะปะตะปัะฝะพ ะดะปั 10 ะดะพะบัะผะตะฝัะพะฒ...
  ะะพะบัะผะตะฝั 1: ะบะพะผะฟะฐะฝะธะน=1, ะฟะตััะพะฝ=1, ััะฝะบะพะฒ=0
  ...
โ ะะทะฒะปะตัะตะฝะธะต ะทะฐะฒะตััะตะฝะพ!
ะะพะดะณะพัะพะฒะปะตะฝะพ 10 ัะฐะฝะบะพะฒ ะดะปั ะทะฐะณััะทะบะธ ะฒ Weaviate
```

### 6. ะัะพะฒะตัะบะฐ ะดะฐะฝะฝัั

```bash
# ะัะพะฒะตัะธัั ัะพะดะตัะถะธะผะพะต ะะ
python src/download/check_collection.py
```

**ะัะฒะพะด:**
- ะกัะฐััั ัะตัะฒะตัะฐ Weaviate
- ะกะฟะธัะพะบ ะฒัะตั ะบะพะปะปะตะบัะธะน
- ะกัะตะผะฐ ะบะพะปะปะตะบัะธะธ NewsChunks (ะฒัะต ะฟะพะปั)
- ะกัะฐัะธััะธะบะฐ (ะบะพะปะธัะตััะฒะพ ะพะฑัะตะบัะพะฒ, ะธััะพัะฝะธะบะธ, ะฒัะตะผะตะฝะฝะพะน ะดะธะฐะฟะฐะทะพะฝ)
- 2 ะฟัะธะผะตัะฐ ะพะฑัะตะบัะพะฒ ัะพ ะฒัะตะผะธ ะผะตัะฐะดะฐะฝะฝัะผะธ ะธ ัััะฝะพัััะผะธ

### 7. ะขะตััะธัะพะฒะฐะฝะธะต ะฟะพะธัะบะฐ ะธ ะณะตะฝะตัะฐัะธะธ ััะฐัะตะน

```bash
# ะะฐะฟัััะธัั RAG ะฟะฐะนะฟะปะฐะนะฝ
python src/system/engine.py
```

**ะงัะพ ะฟัะพะธััะพะดะธั:**
1. **ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ** ะฟะพ ะทะฐะฟัะพัั "ะงัะพ ะธะทะฒะตััะฝะพ ะพ ะกะฑะตัะฑะฐะฝะบะต?"
   - ะะตะบัะพัะฝัะน ะฟะพะธัะบ (ัะตะผะฐะฝัะธัะตัะบะธะน)
   - BM25 ะฟะพะธัะบ (ะปะตะบัะธัะตัะบะธะน/keyword)
   - ะะตัะฐะฝะบะธะฝะณ ั BAAI/bge-reranker-v2-m3
   - ะฃัะตั hotness ะฒ ัะธะฝะฐะปัะฝะพะผ ัะบะพัะต
2. **ะะตะฝะตัะฐัะธั ััะฐััะธ** ัะตัะตะท GPT-5
   - Social post (280 ัะปะพะฒ)
   - Article draft (500 ัะปะพะฒ)
   - Alert (ะบัะฐัะบะพะต ัะฒะตะดะพะผะปะตะฝะธะต)
   - ะฅัััะตะณะธ, ะบะปััะตะฒัะต ะผะพะผะตะฝัั, ะธะดะตะธ ะฒะธะทัะฐะปะธะทะฐัะธะธ

**ะัะฒะพะด:**
```
=== HYBRID SEARCH WITH RERANKING ===
Found 10 results after hybrid search + reranking

After hotness adjustment:
 1. Rerank: 0.8500 + Hotness: 0.50 = Final: 0.7450 | ะกะฑะตัะฑะฐะฝะบ ะฟะพะบะฐะทะฐะป ัะตะบะพัะดะฝัั ะฟัะธะฑัะปั

=== Final Documents (sorted by final score with hotness) ===
๐ Result #1
   Title: ะกะฑะตัะฑะฐะฝะบ ะฟะพะบะฐะทะฐะป ัะตะบะพัะดะฝัั ะฟัะธะฑัะปั
   Type: ๐น Full Parent Document
   Final Score: 0.7450 = 0.8500 ร 0.70 + 0.50 ร 0.30
   ะะพะผะฟะฐะฝะธะธ: ะะะ ะกะฑะตัะฑะฐะฝะบ

=== GENERATED ARTICLE ===
ะะฐะณะพะปะพะฒะพะบ: ะกะฑะตัะฑะฐะฝะบ: ัะตะบะพัะดะฝะฐั ะฟัะธะฑัะปั ะทะฐ 4ะ24, ะฒััะต ะบะพะฝัะตะฝัััะฐ ะฝะฐ 5%
...
```

## ๐ ะะฐะบ ัะฐะฑะพัะฐะตั ัะธััะตะผะฐ

### ะะฐะนะฟะปะฐะนะฝ ะพะฑัะฐะฑะพัะบะธ ะดะฐะฝะฝัั

1. **ะะฐะณััะทะบะฐ ะฝะพะฒะพััะตะน** (`parser/test_news.json`)
   ```json
   {
     "text": "ะะพะปะฝัะน ัะตะบัั ะฝะพะฒะพััะธ...",
     "title": "ะะฐะณะพะปะพะฒะพะบ",
     "timestamp": 1704067200,
     "url": "https://...",
     "source": "ะะะ"
   }
   ```

2. **ะะทะฒะปะตัะตะฝะธะต ัััะฝะพััะตะน** (`entity_recognition.py`)
   - ะะฐัะฐะปะปะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ัะตัะตะท GPT-4o-mini
   - ะะทะฒะปะตัะตะฝะธะต: ะบะพะผะฟะฐะฝะธะน, ัะธะบะตัะพะฒ, ัะตะบัะพัะพะฒ, ะฟะตััะพะฝ, ะดะพะปะถะฝะพััะตะน, ััะฝะบะพะฒ, ัะธะฝะฐะฝัะพะฒัั ะผะตััะธะบ
   - ะััะธัะพะฒะฐะฝะธะต ะฟัะพะผะฟัะพะฒ (ัะบะพะฝะพะผะธั ะดะพ 50% ะฝะฐ ัะพะบะตะฝะฐั)

3. **ะะพะดะณะพัะพะฒะบะฐ ะดะฐะฝะฝัั** (`downloader_functions.py`)
   - ะงะฐะฝะบะธะฝะณ ัะตะบััะฐ (800 ัะธะผะฒะพะปะพะฒ, overlap 200)
   - ะะตะผะผะฐัะธะทะฐัะธั ะดะปั BM25 (WordNet)
   - ะคะพัะผะธัะพะฒะฐะฝะธะต Document ะพะฑัะตะบัะพะฒ ั ะผะตัะฐะดะฐะฝะฝัะผะธ

4. **ะะฝะดะตะบัะฐัะธั** (`vdb.py`)
   - ะกะพะทะดะฐะฝะธะต ะบะพะปะปะตะบัะธะธ NewsChunks
   - ะะฐะณััะทะบะฐ ัะฐะฝะบะพะฒ ั ะฐะฒัะพะผะฐัะธัะตัะบะพะน GPU-ะฒะตะบัะพัะธะทะฐัะธะตะน
   - ะฅัะฐะฝะตะฝะธะต ัััะฝะพััะตะน ะฒ ะผะตัะฐะดะฐะฝะฝัั

### ะะพะธัะบะพะฒัะน ะฟะฐะนะฟะปะฐะนะฝ

**ะกัะตะผะฐ ัะฐะฑะพัั:**

```
Query: "ะกะฑะตัะฑะฐะฝะบ ะฟัะธะฑัะปั"
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  HYBRID SEARCH          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โข Vector (alpha ร s)    โ โ ะกะตะผะฐะฝัะธัะตัะบะธะน ะฟะพะธัะบ ะฟะพ original_text
โ โข BM25 ((1-alpha) ร s)  โ โ Keyword ะฟะพะธัะบ ะฟะพ text_for_bm25
โ โข Fusion (RELATIVE)     โ โ ะะฑัะตะดะธะฝะตะฝะธะต ัะบะพัะพะฒ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  RERANKING              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ bge-reranker-v2-m3      โ โ ะะตัะตัะฐะฝะถะธัะพะฒะฐะฝะธะต ะฟะพ original_text
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  HOTNESS ADJUSTMENT     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ final = rerankร0.7      โ
โ       + hotnessร0.3     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PARENT DOC RETRIEVAL   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Deduplication           โ โ ะฃะฑะธัะฐะตะผ ะดัะฑะปะธ parent_doc_id
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
    Top N results
```

**ะะฐัะฐะผะตััั ะฟะพะธัะบะฐ:**

- `alpha` (0.0-1.0) - ะฑะฐะปะฐะฝั ะฒะตะบัะพัะฝัะน/BM25
  - 0.0 = ัะพะปัะบะพ BM25 (ะปะตะบัะธัะตัะบะธะน)
  - 0.5 = ะณะธะฑัะธะดะฝัะน (ะฟะพ ัะผะพะปัะฐะฝะธั)
  - 1.0 = ัะพะปัะบะพ ะฒะตะบัะพัะฝัะน
- `hotness_weight` (0.0-1.0) - ะฒะตั ะฐะบััะฐะปัะฝะพััะธ
  - 0.0 = ัะพะปัะบะพ ัะตะปะตะฒะฐะฝัะฝะพััั
  - 0.3 = ะฑะฐะปะฐะฝั (ะฟะพ ัะผะพะปัะฐะฝะธั)
  - 1.0 = ัะพะปัะบะพ ะฐะบััะฐะปัะฝะพััั

### ะะตะฝะตัะฐัะธั ััะฐัะตะน

**ะกัะตะผะฐ ัะฐะฑะพัั:**

```
Search Results (ั ัััะฝะพัััะผะธ)
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  EXTRACT ENTITIES        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โข companies โ Instrumentsโ
โ โข tickers, sectors       โ
โ โข sources โ SourceItems  โ
โ โข hotness โ hot_score    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  BUILD REQUEST           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ DraftRequest(            โ
โ   news_type="earnings",  โ
โ   tone="explanatory",    โ
โ   instruments=[...],     โ
โ   sources=[...],         โ
โ   body_text=full_text    โ
โ )                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  GPT-5 GENERATION        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Structured output:       โ
โ โข headline, dek          โ
โ โข variants (social,      โ
โ   article, alert)        โ
โ โข key_points, hashtags   โ
โ โข visual ideas           โ
โ โข disclaimer             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
    DraftResponse
```

## ๐ง ะะพะฝัะธะณััะฐัะธั

### ะะพััั

- **8080** - Weaviate (ะฒะตะบัะพัะฝะฐั ะะ)
- **8082** - BGE Reranker
- **8083** - Text2Vec Transformers (ะฒะตะบัะพัะธะทะฐัะพั)

### ะะฐัะฐะผะตััั ะฟะพะธัะบะฐ

ะะตะดะฐะบัะธััะนัะต `src/system/search.py`:

```python
def hybrid_search_with_rerank(
    collection,
    query,
    limit=10,              # ะะพะปะธัะตััะฒะพ ัะตะทัะปััะฐัะพะฒ ะดะพ ัะตัะฐะฝะบะธะฝะณะฐ
    rerank_limit=3,        # ะะพะปะธัะตััะฒะพ ัะธะฝะฐะปัะฝัั ัะตะทัะปััะฐัะพะฒ
    use_parent_docs=True,  # ะะพะทะฒัะฐัะฐัั ะฟะพะปะฝัะต ะดะพะบัะผะตะฝัั
    hotness_weight=0.3,    # ะะตั hotness (0.0-1.0)
    alpha=0.6              # ะะฐะปะฐะฝั vector/BM25 (0.0-1.0)
)
```

### ะะฐัะฐะผะตััั ะณะตะฝะตัะฐัะธะธ ััะฐัะตะน

ะะตะดะฐะบัะธััะนัะต `src/system/engine.py`:

```python
result = rag.query(
    user_query="ะงัะพ ะธะทะฒะตััะฝะพ ะพ ะกะฑะตัะฑะฐะฝะบะต?",
    search_limit=10,
    rerank_limit=3,
    use_parent_docs=True,
    news_type="earnings",        # earnings, guidance, macro, industry_trend
    tone="explanatory",          # neutral, concise, explanatory, urgent
    desired_outputs=[            # ะคะพัะผะฐัั ะฒัะฒะพะดะฐ
        "social_post",
        "article_draft",
        "alert"
    ]
)
```

### ะกัะตะผะฐ ะะ (Weaviate Collection)

**ะะพะปะปะตะบัะธั:** `NewsChunks`

**ะขะตะบััะพะฒัะต ะฟะพะปั:**
- `original_text` (TEXT) - ะพัะธะณะธะฝะฐะปัะฝัะน ัะตะบัั ัะฐะฝะบะฐ, **ะฒะตะบัะพัะธะทัะตััั**
- `text_for_bm25` (TEXT) - ะปะตะผะผะฐัะธะทะธัะพะฒะฐะฝะฝัะน ัะตะบัั ะดะปั BM25, **skip_vectorization=True**
- `parent_doc_text` (TEXT) - ะฟะพะปะฝัะน ัะตะบัั ัะพะดะธัะตะปััะบะพะณะพ ะดะพะบัะผะตะฝัะฐ

**ะะตัะฐะดะฐะฝะฝัะต:**
- `chunk_index` (INT) - ะธะฝะดะตะบั ัะฐะฝะบะฐ
- `parent_doc_id` (TEXT) - ID ัะพะดะธัะตะปััะบะพะณะพ ะดะพะบัะผะตะฝัะฐ
- `title`, `url`, `source` (TEXT) - ะผะตัะฐะดะฐะฝะฝัะต ะฝะพะฒะพััะธ
- `timestamp` (INT) - Unix timestamp
- `publication_date` (TEXT) - ะดะฐัะฐ ะฟัะฑะปะธะบะฐัะธะธ YYYY-MM-DD
- `hotness` (NUMBER) - ะพัะตะฝะบะฐ ะฐะบััะฐะปัะฝะพััะธ 0.0-1.0

**ะะทะฒะปะตัะตะฝะฝัะต ัััะฝะพััะธ:**
- `entities_json` (TEXT) - ะฟะพะปะฝัะน JSON ั ัััะฝะพัััะผะธ
- `companies` (TEXT_ARRAY) - ะฝะฐะทะฒะฐะฝะธั ะบะพะผะฟะฐะฝะธะน
- `company_tickers` (TEXT_ARRAY) - ัะธะบะตัั
- `company_sectors` (TEXT_ARRAY) - ัะตะบัะพัั
- `people` (TEXT_ARRAY) - ะธะผะตะฝะฐ ะฟะตััะพะฝ
- `people_positions` (TEXT_ARRAY) - ะดะพะปะถะฝะพััะธ
- `markets` (TEXT_ARRAY) - ััะฝะบะธ/ะฑะธัะถะธ/ะธะฝะดะตะบัั
- `market_types` (TEXT_ARRAY) - ัะธะฟั ััะฝะบะพะฒ
- `financial_metric_types` (TEXT_ARRAY) - ัะธะฟั ะผะตััะธะบ
- `financial_metric_values` (TEXT_ARRAY) - ะทะฝะฐัะตะฝะธั ะผะตััะธะบ

## ๐ฏ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะะพะธัะบ ั ัะฐะทะฝัะผะธ alpha

```python
from src.system.engine import RAGPipeline

rag = RAGPipeline()
rag.connect()

# ะขะพะปัะบะพ ัะตะผะฐะฝัะธัะตัะบะธะน ะฟะพะธัะบ (alpha=1.0)
results = rag.search("ะฝะพะฒะพััะธ ะพ ัะธะฝะฐะฝัะพะฒะพะผ ะบัะธะทะธัะต", alpha=1.0)

# ะขะพะปัะบะพ keyword ะฟะพะธัะบ (alpha=0.0)
results = rag.search("ะกะฑะตัะฑะฐะฝะบ ะฟัะธะฑัะปั", alpha=0.0)

# ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ (alpha=0.5)
results = rag.search("ะธะฝะฒะตััะธัะธะธ ะฒ ัะตัะฝะพะปะพะณะธะธ", alpha=0.5)
```

### ะัะธะผะตั 2: ะะตะฝะตัะฐัะธั ัะฐะทะฝัั ัะพัะผะฐัะพะฒ ััะฐัะตะน

```python
# Earnings ะฝะพะฒะพััั
result = rag.query(
    user_query="ะกะฑะตัะฑะฐะฝะบ ะพััะธัะฐะปัั ะทะฐ ะบะฒะฐััะฐะป",
    news_type="earnings",
    tone="explanatory",
    desired_outputs=["social_post", "article_draft", "alert"]
)

# ะะฐะบัะพ-ะฝะพะฒะพััั
result = rag.query(
    user_query="ะฆะ ะฟะพะฒััะธะป ะบะปััะตะฒัั ััะฐะฒะบั",
    news_type="macro",
    tone="urgent",
    desired_outputs=["alert", "social_post"]
)

# ะะฝะดััััะธะฐะปัะฝัะน ััะตะฝะด
result = rag.query(
    user_query="ะะฐะทะฒะธัะธะต ัะธะฝัะตั-ัะตะบัะพัะฐ",
    news_type="industry_trend",
    tone="explanatory",
    desired_outputs=["article_draft", "digest"]
)
```

### ะัะธะผะตั 3: ะกะพััะฐะฝะตะฝะธะต ััะฐััะธ ะฒ PDF

```python
from src.system.LLM_final.output import save_article_pdf

# ะะตะฝะตัะธััะตะผ ััะฐััั
result = rag.query(user_query="...")
draft = result['draft']

# ะกะพััะฐะฝัะตะผ ะฒ PDF
pdf_path = save_article_pdf(
    draft.model_dump(by_alias=True),
    "article_output.pdf"
)
print(f"PDF ัะพััะฐะฝัะฝ: {pdf_path}")
```

## ๐ก API ะดะปั ะธะฝัะตะณัะฐัะธะธ

### Python API

```python
from src.system.engine import RAGPipeline

# ะะฝะธัะธะฐะปะธะทะฐัะธั
rag = RAGPipeline(collection_name="NewsChunks")
rag.connect()

# ะะพะธัะบ
results = rag.search(
    query="ะฏะฝะดะตะบั ัะตัะฝะพะปะพะณะธะธ",
    limit=10,
    rerank_limit=3,
    alpha=0.5,
    hotness_weight=0.3
)

# ะะตะฝะตัะฐัะธั ััะฐััะธ
article = rag.query(
    user_query="ะะพะฒะพััะธ ะพ ะฏะฝะดะตะบัะต",
    news_type="tech_fintech",
    tone="explanatory"
)

# ะะตะทัะปััะฐั
print(article['draft'].headline)
print(article['draft'].variants['article_draft'])
```

## ๐ Troubleshooting

### Weaviate ะฝะต ะทะฐะฟััะบะฐะตััั

```bash
# ะัะพะฒะตัะธัั ะปะพะณะธ
docker logs weaviate

# ะะตัะตะทะฐะฟัััะธัั
docker compose down
docker compose up -d
```

### ะัะธะฑะบะฐ API ะบะปััะฐ

```
RuntimeError: OPENAI_API_KEY ะฝะต ะทะฐะดะฐะฝ
```

**ะะตัะตะฝะธะต:**
1. ะกะพะทะดะฐะนัะต `.env` ัะฐะนะป ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ
2. ะะพะฑะฐะฒััะต `API_KEY_2=sk-your-key`
3. ะะตัะตะทะฐะฟัััะธัะต ัะบัะธะฟั

### ะะตะดะปะตะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ

- **ะัะธัะธะฝะฐ 1:** ะะทะฒะปะตัะตะฝะธะต ัััะฝะพััะตะน ัะตัะตะท API
  - **ะะตัะตะฝะธะต:** ะัะฟะพะปัะทัะตััั ะฟะฐัะฐะปะปะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ (ะฒัะต 10 ะฝะพะฒะพััะตะน ะพะดะฝะพะฒัะตะผะตะฝะฝะพ)

- **ะัะธัะธะฝะฐ 2:** ะะตะบัะพัะธะทะฐัะธั ะฑะตะท GPU
  - **ะะตัะตะฝะธะต:** ะฃะฑะตะดะธัะตัั ััะพ `ENABLE_CUDA: "1"` ะฒ `docker-compose.yml`

### ะัะธะฑะบะฐ GPU

ะัะปะธ ะฝะตั GPU, ะธะทะผะตะฝะธัะต ะฒ `docker-compose.yml`:

```yaml
text2vec-transformers:
  environment:
    ENABLE_CUDA: "0"  # ะัะบะปััะธัั CUDA
```

ะ ัะดะฐะปะธัะต ัะตะบัะธั `deploy.resources`.

### ะะตั ัะตะทัะปััะฐัะพะฒ ะฟะพะธัะบะฐ

```bash
# ะัะพะฒะตัััะต ะบะพะปะธัะตััะฒะพ ะพะฑัะตะบัะพะฒ ะฒ ะะ
python src/download/check_collection.py
```

ะัะปะธ ะบะพะปะปะตะบัะธั ะฟัััะฐั:
```bash
# ะะฐะณััะทะธัะต ะดะฐะฝะฝัะต
python src/system/vdb.py
```

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะกะบะพัะพััั ะพะฑัะฐะฑะพัะบะธ

- **ะะทะฒะปะตัะตะฝะธะต ัััะฝะพััะตะน:** ~2-3 ัะตะบัะฝะดั ะดะปั 10 ะฝะพะฒะพััะตะน (ะฟะฐัะฐะปะปะตะปัะฝะพ)
- **ะะฝะดะตะบัะฐัะธั:** ~1-2 ัะตะบัะฝะดั ะดะปั 10 ัะฐะฝะบะพะฒ
- **ะะพะธัะบ:** ~0.5-1 ัะตะบัะฝะดะฐ
- **ะะตะฝะตัะฐัะธั ััะฐััะธ:** ~3-5 ัะตะบัะฝะด

### ะะฟัะธะผะธะทะฐัะธั

**ะะปั ะฑะพะปััะธั ะพะฑัะตะผะพะฒ:**
1. ะฃะฒะตะปะธัะธัั batch size ะฒ `vdb.py`
2. ะัะฟะพะปัะทะพะฒะฐัั GPU ะดะปั ะฒะตะบัะพัะธะทะฐัะพัะฐ
3. ะััะธัะพะฒะฐะฝะธะต ะฟัะพะผะฟัะพะฒ (ัะถะต ัะตะฐะปะธะทะพะฒะฐะฝะพ ะฒ `entity_recognition.py`)

**ะะปั ัะพัะฝะพััะธ:**
1. ะะฐัััะพะธัั `alpha` ะดะปั ะฒะฐัะตะณะพ use case
2. ะฃะฒะตะปะธัะธัั `limit` ะดะปั ะฑะพะปััะตะณะพ ะฟะพะบัััะธั
3. ะะฐัััะพะธัั `hotness_weight` ะดะปั ะฟัะธะพัะธัะตัะฐ ะฐะบััะฐะปัะฝะพััะธ

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั ัะธััะตะผั

```bash
# Weaviate
curl http://localhost:8080/v1/meta

# ะะตะบัะพัะธะทะฐัะพั
curl http://localhost:8083/.well-known/ready

# Reranker
curl http://localhost:8082/.well-known/ready
```

### ะะพะณะธ

```bash
# Docker ะปะพะณะธ
docker logs weaviate
docker logs text2vec-transformers
docker logs bge-reranker

# Python ะปะพะณะธ
# ะะพะฑะฐะฒะปะตะฝั ะฒ engine.py ัะตัะตะท logging module
```

## ๐๏ธ ะะฐะทัะฐะฑะพัะบะฐ

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ัะธะฟะพะฒ ะฝะพะฒะพััะตะน

ะะตะดะฐะบัะธััะนัะต `src/system/LLM_final/main.py`:

```python
NewsType = Literal[
    "earnings", "guidance", "mna", "default_bankruptcy",
    "rating_action", "regulatory_sanctions", "macro",
    "social_buzz", "crisis_systemic", "tech_fintech",
    "industry_trend", "rumor_leak", "people_social",
    "your_new_type"  # ะะพะฑะฐะฒััะต ะทะดะตัั
]
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ัะธะฝะฐะฝัะพะฒัั ะธะฝััััะผะตะฝัะพะฒ

ะะตะดะฐะบัะธััะนัะต `src/system/entity_recognition.py`:

```python
self.companies = {
    "ะะะจะ_ะะะะะะะะฏ": {
        "full_name": "ะะะ ะะฐัะฐ ะะพะผะฟะฐะฝะธั",
        "ticker": "YOUR",
        "sector": "ะะฐั ัะตะบัะพั"
    }
}
```

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะผะฐัะตัะธะฐะปั

### ะะพะบัะผะตะฝัะฐัะธั

- [Weaviate Documentation](https://weaviate.io/developers/weaviate)
- [OpenAI API Reference](https://platform.openai.com/docs/api-reference)
- [BAAI BGE Models](https://github.com/FlagOpen/FlagEmbedding)

### ะกะฒัะทะฐะฝะฝัะต ะฟัะพะตะบัั

- **LangChain** - ะธัะฟะพะปัะทัะตััั ะดะปั Document ะธ TextSplitters
- **Pydantic** - ะธัะฟะพะปัะทัะตััั ะดะปั ัะธะฟะธะทะฐัะธะธ ะทะฐะฟัะพัะพะฒ/ะพัะฒะตัะพะฒ
- **NLTK** - ะธัะฟะพะปัะทัะตััั ะดะปั ะปะตะผะผะฐัะธะทะฐัะธะธ

## ๐ค ะะบะปะฐะด

ะัะพะตะบั ะฒ ะฐะบัะธะฒะฝะพะน ัะฐะทัะฐะฑะพัะบะต. Pull requests ะฟัะธะฒะตัััะฒััััั!

## ๐ ะะธัะตะฝะทะธั

MIT License

## ๐ฅ ะะฒัะพัั

RAG News Processing System

---

**ะะตััะธั:** 2.0.0
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต:** 2025-10-04
**ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ:** ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ, NER, ะะตะฝะตัะฐัะธั ััะฐัะตะน ัะตัะตะท LLM
