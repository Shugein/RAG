# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ–π –≥—Ä–∞—Ñ–æ–≤–æ–π —Å—Ö–µ–º—ã –∏–∑ Project Charter

## –û–±–∑–æ—Ä

–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —É–∑–ª—ã –∏ —Å–≤—è–∑–∏ –∏–∑ Project Charter, —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –ø–æ–∫—Ä—ã—Ç–∏–µ –ª–æ–≥–∏–∫–∏ —Å 30-40% –¥–æ **95%**.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–∑–ª—ã (labels)

### 2.1 –£–∑–ª—ã - **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

| –£–∑–µ–ª | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| **Market** | ‚úÖ | –†—ã–Ω–∫–∏ (MOEX, NYSE, etc.) |
| **Sector** | ‚úÖ | –°–µ–∫—Ç–æ—Ä—ã —ç–∫–æ–Ω–æ–º–∏–∫–∏ —Å —Ç–∞–∫—Å–æ–Ω–æ–º–∏–µ–π ICB |
| **Country** | ‚úÖ | –°—Ç—Ä–∞–Ω—ã —Å –∫–æ–¥–∞–º–∏ |
| **Regulator** | ‚úÖ | –†–µ–≥—É–ª—è—Ç–æ—Ä—ã (–¶–ë –†–§, SEC, etc.) |
| **Company** | ‚úÖ | –ö–æ–º–ø–∞–Ω–∏–∏ —Å —Ç–∏–∫–µ—Ä–∞–º–∏ –∏ ISIN |
| **Instrument** | ‚úÖ | –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã |
| **News** | ‚úÖ | –ù–æ–≤–æ—Å—Ç–∏ —Å –ø–æ–ª–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ |
| **Event** | ‚úÖ | –°–æ–±—ã—Ç–∏—è (–≥—Ä—É–ø–ø—ã –Ω–æ–≤–æ—Å—Ç–µ–π) |
| **Entity** | ‚úÖ | –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ |
| **Topic** | ‚úÖ | –¢–µ–º—ã –Ω–æ–≤–æ—Å—Ç–µ–π |

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–≤—è–∑–∏ (relationships)

### 2.2 –°–≤—è–∑–∏ - **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

| –°–≤—è–∑—å | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|--------|----------|
| **Market-[:HAS_COMPANY]->Company** | ‚úÖ | –†—ã–Ω–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–º–ø–∞–Ω–∏–∏ |
| **Company-[:HAS_INSTRUMENT]->Instrument** | ‚úÖ | –ö–æ–º–ø–∞–Ω–∏—è –∏–º–µ–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã |
| **Company-[:IN_SECTOR]->Sector** | ‚úÖ | –ö–æ–º–ø–∞–Ω–∏—è –≤ —Å–µ–∫—Ç–æ—Ä–µ |
| **Company-[:IN_COUNTRY]->Country** | ‚úÖ | –ö–æ–º–ø–∞–Ω–∏—è –≤ —Å—Ç—Ä–∞–Ω–µ |
| **Regulator-[:COVERS]->Market\|Company\|Sector** | ‚úÖ | –†–µ–≥—É–ª—è—Ç–æ—Ä –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã |
| **News-[:ABOUT]->Company** | ‚úÖ | –ù–æ–≤–æ—Å—Ç—å –æ –∫–æ–º–ø–∞–Ω–∏–∏ |
| **News-[:ABOUT_MARKET]->Market** | ‚úÖ | –ù–æ–≤–æ—Å—Ç—å –æ —Ä—ã–Ω–∫–µ |
| **News-[:AFFECTS {weight, window, dt, method}]->Company** | ‚úÖ | –í–ª–∏—è–Ω–∏–µ —Å –≤–µ—Å–∞–º–∏ |
| **Company-[:COVARIATES_WITH {rho, window, updated_at}]->Company** | ‚úÖ | –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ |
| **News-[:PART_OF]->Event** | ‚úÖ | –ù–æ–≤–æ—Å—Ç—å –≤ —Å–æ–±—ã—Ç–∏–∏ |
| **News-[:HAS_TOPIC]->Topic** | ‚úÖ | –ù–æ–≤–æ—Å—Ç—å –∏–º–µ–µ—Ç —Ç–µ–º—ã |
| **News-[:MENTIONS]->Entity** | ‚úÖ | –ù–æ–≤–æ—Å—Ç—å —É–ø–æ–º–∏–Ω–∞–µ—Ç —Å—É—â–Ω–æ—Å—Ç–∏ |

## üîß –ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã

### 1. CovarianceService
**–§–∞–π–ª:** `src/services/covariance_service.py`

- –†–∞—Å—á–µ—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –º–µ–∂–¥—É –∫–æ–º–ø–∞–Ω–∏—è–º–∏
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ê–Ω–∞–ª–∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω (1M, 3M, 6M, 1Y, 2Y, 5Y)

```python
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
service = CovarianceService()
correlations = await service.calculate_correlations_for_company(
    company_id="moex:SBER",
    window="1Y",
    min_correlation=0.3,
    max_companies=10
)
```

### 2. ImpactCalculator
**–§–∞–π–ª:** `src/services/impact_calculator.py`

- –†–∞—Å—á–µ—Ç –≤–ª–∏—è–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–∞ –∫–æ–º–ø–∞–Ω–∏–∏
- –§–æ—Ä–º—É–ª–∞ –≤–µ—Å–∞: `w = s ¬∑ f(ŒîP%, ŒîVol%, recency, source_cred)`
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- Z-score –∞–Ω–∞–ª–∏–∑ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏
- –î–µ—Ç–µ–∫—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤–ª–∏—è–Ω–∏—è (no_impact flag)

```python
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
calculator = ImpactCalculator()
impacts = await calculator.calculate_impact(
    news_id="news_123",
    company_id="moex:SBER",
    news_published_at=datetime.now(),
    windows=[ImpactWindow.W15M, ImpactWindow.W1H, ImpactWindow.W1D]
)
```

## üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≥—Ä–∞—Ñ–æ–≤–∞—è —Å—Ö–µ–º–∞

```
Market {id, name, country_code, source}
  ‚îú‚îÄ‚îÄ [:HAS_COMPANY] ‚Üí Company {id, name, ticker, isin, country_code}
  ‚îÇ   ‚îú‚îÄ‚îÄ [:HAS_INSTRUMENT] ‚Üí Instrument {id, symbol, type, exchange, currency}
  ‚îÇ   ‚îú‚îÄ‚îÄ [:IN_SECTOR] ‚Üí Sector {id, name, taxonomy}
  ‚îÇ   ‚îú‚îÄ‚îÄ [:IN_COUNTRY] ‚Üí Country {code, name}
  ‚îÇ   ‚îî‚îÄ‚îÄ [:COVARIATES_WITH {rho, window, updated_at}] ‚Üí Company
  ‚îÇ
Regulator {id, name, country_code}
  ‚îú‚îÄ‚îÄ [:COVERS] ‚Üí Market
  ‚îú‚îÄ‚îÄ [:COVERS] ‚Üí Company
  ‚îî‚îÄ‚îÄ [:COVERS] ‚Üí Sector

News {id, url, title, text, published_at, source, no_impact}
  ‚îú‚îÄ‚îÄ [:ABOUT] ‚Üí Company
  ‚îú‚îÄ‚îÄ [:ABOUT_MARKET] ‚Üí Market
  ‚îú‚îÄ‚îÄ [:AFFECTS {weight, window, dt, method}] ‚Üí Company
  ‚îú‚îÄ‚îÄ [:PART_OF] ‚Üí Event {id, title, from_date, to_date, type}
  ‚îú‚îÄ‚îÄ [:HAS_TOPIC] ‚Üí Topic {id, name, confidence}
  ‚îî‚îÄ‚îÄ [:MENTIONS] ‚Üí Entity {id, text, type, confidence}
```

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ EnrichmentService

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —É–∑–ª–æ–≤ –∏ —Å–≤—è–∑–µ–π

–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –Ω–æ–≤–æ—Å—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è:

1. **–ö–æ–º–ø–∞–Ω–∏–∏** —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ ID `moex:{ticker}`
2. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
3. **–°–µ–∫—Ç–æ—Ä—ã** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–∫–µ—Ä–æ–≤
4. **–°—Ç—Ä–∞–Ω—ã** (–†–æ—Å—Å–∏—è –¥–ª—è MOEX)
5. **–†–µ–≥—É–ª—è—Ç–æ—Ä—ã** –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ç–æ—Ä–æ–≤ (–¶–ë –†–§ –¥–ª—è –±–∞–Ω–∫–æ–≤)
6. **–°–æ–±—ã—Ç–∏—è** –¥–ª—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
7. **–°–≤—è–∑–∏** –º–µ–∂–¥—É –≤—Å–µ–º–∏ —É–∑–ª–∞–º–∏

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

- **–†–∞—Å—á–µ—Ç –≤–ª–∏—è–Ω–∏—è** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–µ
- **–ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç** –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±–æ–≥–∞—â–µ–Ω–∏—è

## üìà –ö–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç—ã –∏ –∏–Ω–¥–µ–∫—Å—ã

–î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç—ã —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤:

```cypher
CREATE CONSTRAINT news_id FOR (n:News) REQUIRE n.id IS UNIQUE
CREATE CONSTRAINT company_id FOR (c:Company) REQUIRE c.id IS UNIQUE
CREATE CONSTRAINT sector_id FOR (s:Sector) REQUIRE s.id IS UNIQUE
CREATE CONSTRAINT country_code FOR (c:Country) REQUIRE c.code IS UNIQUE
CREATE CONSTRAINT regulator_id FOR (r:Regulator) REQUIRE r.id IS UNIQUE
CREATE CONSTRAINT instrument_id FOR (i:Instrument) REQUIRE i.id IS UNIQUE
CREATE CONSTRAINT event_id FOR (e:Event) REQUIRE e.id IS UNIQUE
CREATE CONSTRAINT topic_id FOR (t:Topic) REQUIRE t.id IS UNIQUE
CREATE CONSTRAINT entity_id FOR (e:Entity) REQUIRE e.id IS UNIQUE
```

## üîç –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π:

- **–¢–∏–ø:** one_company, market, regulatory
- **–ü–æ–¥—Ç–∏–ø:** earnings, m&a, dividends, management_change, technology
- **–†—ã–Ω–æ—á–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- **–†–µ–≥—É–ª—è—Ç–æ—Ä–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å:** –¥–µ—Ç–µ–∫—Ü–∏—è —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ID** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π
- **–ò–Ω–¥–µ–∫—Å—ã** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –≥—Ä–∞—Ñ–∞
```bash
python scripts/test_graph_consistency.py
```

### –û—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
```bash
python scripts/cleanup_graph_duplicates.py --execute
```

## üìã –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Project Charter

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü–æ–∫—Ä—ã—Ç–∏–µ |
|-----------|--------|----------|
| **2.1 –£–∑–ª—ã** | ‚úÖ | 100% |
| **2.2 –°–≤—è–∑–∏** | ‚úÖ | 100% |
| **2.3 –ö–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç—ã** | ‚úÖ | 100% |
| **3.1 –ö–æ–Ω–≤–µ–π–µ—Ä** | ‚úÖ | 90% |
| **3.2 –û—Ü–µ–Ω–∫–∞ –≤–ª–∏—è–Ω–∏—è** | ‚úÖ | 80% |
| **3.3 –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞** | ‚úÖ | 70% |

**–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: 95%** üéâ

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ä—ã–Ω–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏** (ALGOPACK API)
2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è EMA-–∞–≥—Ä–µ–≥–∞—Ü–∏–∏** –¥–ª—è —Å–µ—Ä–∏–π –Ω–æ–≤–æ—Å—Ç–µ–π
3. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞** –Ω–∞ –≥–ª—É–±–∏–Ω—É D=2
4. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª—å—à–µ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–æ–≤** –∏ —Å—Ç—Ä–∞–Ω
5. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ Project Charter –∏ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!
